def SLAVE = AMBIENTE.equals('PRODUCAO') ? 'master' : 'hom01'
def BRANCH = AMBIENTE.equals('PRODUCAO') ? 'master' : 'develop'
def json = null

node() {

    stage ('Preparando') {
        git branch: String.valueOf(BRANCH), credentialsId: 'GITLAB', url: '${GITURL}'
        json = readJSON file: 'package.json'
    }

    stage ('App Build') {
        cleanWs()
        build job: '/servicos/react_build_deploy_nexus', parameters: [
            string(name: 'GITURL', value: String.valueOf(GITURL)), 
            string(name: 'GITBRANCH', value: String.valueOf(BRANCH))
        ]
    }

    stage ('Docker Build') {
        build job: '/servicos/react_build_docker_image', parameters: [
            string(name: 'ARTIFACTID', value: String.valueOf(json.name)),
            string(name: 'VERSION', value: String.valueOf(json.version))
        ]
    }
/*    
    stage ('Docker Run') {
    
        build job: '/servicos/docker_start_container', parameters: [
            string(name: 'SLAVE', value: String.valueOf(SLAVE)),
            string(name: 'ARTIFACTID', value: String.valueOf(json.name)),
            string(name: 'VERSION', value: String.valueOf(json.version)),
            string(name: 'PORTA', value: String.valueOf(PORTA))
        ] 
    }
*/
}

